<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>BTK Python wrapper: More Tutorials</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="DoxygenStyleSheet_Python.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BTK Python wrapper
   &#160;<span id="projectnumber">0.3dev.0</span>
   </div>
   <div id="projectbrief">Python bindings for the Biomechanical ToolKit library (BTK)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">More Tutorials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="btkmenu"><a class="el" href="index.html">Overview</a> | <a class="el" href="_build_instructions.html">Building instructions</a> | <a class="el" href="_getting_started.html">Getting started</a> | <b>More</b> <b>Tutorials</b> | <a class="el" href="_license.html">License</a> </div><p>Other tutorials for Python:</p>
<ul>
<li><a class="el" href="_more_tutorials.html#TutorialIteratePython">Iterate through acquisition's content</a></li>
<li><a class="el" href="_more_tutorials.html#TutorialPipelinePython">Pipeline design to process biomechanical data</a></li>
<li><a class="el" href="_more_tutorials.html#TutorialCropAcquisition">Split an acqusition into severals</a></li>
<li><a class="el" href="_more_tutorials.html#TutorialWrappingPython">Technology behind BTK for Python</a></li>
</ul>
<h1><a class="anchor" id="TutorialIteratePython"></a>
Iterate through acquisition's content</h1>
<p>To iterate through acquisition's content (points, analogs, events, metadata), it is possible to use a <em>for</em> loop with indices, a <em>while</em> loop with an iterator or a <em>for</em> loop with the generator <em><a class="el" href="namespacebtk.html#a2ccf00800966129548a08e959e36ec55">btk.Iterate</a></em>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;reader = <a class="code" href="classbtk_1_1btk_acquisition_file_reader.html">btk.btkAcquisitionFileReader</a>()</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;reader.SetFilename(<span class="stringliteral">&quot;myfile.c3d&quot;</span>)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;acq = reader.GetOutput()</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;acq.Update()</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"># Indices</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(0, acq.GetEvents().GetItemNumber()):</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="keywordflow">print</span> acq.GetEvent(i).GetLabel()</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"># Iterator</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;i = acq.GetEvents().Begin()</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keywordflow">while</span> i != acq.GetEvents().End():</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  <span class="keywordflow">print</span> i.value().GetLabel()</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  i.incr()</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"># btk.Iterate</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacebtk.html#a2ccf00800966129548a08e959e36ec55">btk.Iterate</a>(acq.GetEvents()):</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="keywordflow">print</span> i.GetLabel()</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"># Other examples</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacebtk.html#a2ccf00800966129548a08e959e36ec55">btk.Iterate</a>(acq.GetPoints()):</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="keywordflow">print</span> i.GetLabel()</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacebtk.html#a2ccf00800966129548a08e959e36ec55">btk.Iterate</a>(acq.GetAnalogs()):</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordflow">print</span> i.GetLabel()</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacebtk.html#a2ccf00800966129548a08e959e36ec55">btk.Iterate</a>(acq.GetMetaData()):</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> <a class="code" href="namespacebtk.html#a2ccf00800966129548a08e959e36ec55">btk.Iterate</a>(i):</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="keywordflow">print</span> i.GetLabel() + <span class="stringliteral">&quot;:&quot;</span> + j.GetLabel()</div>
</div><!-- fragment --><h1><a class="anchor" id="TutorialPipelinePython"></a>
Pipeline design to process biomechanical data</h1>
<p>More than extracting data from files, BTK gives you the possibility to process acquisition's data. To do that, you can access directly to the data or you can use some "filters" (or processing block) which process data for you.</p>
<p>For example, to compute ground reaction forces, moments and positions, you can use the following Python code.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;reader = <a class="code" href="classbtk_1_1btk_acquisition_file_reader.html">btk.btkAcquisitionFileReader</a>()</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;reader.SetFilename(<span class="stringliteral">&quot;myfile.c3d&quot;</span>)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;pfe = <a class="code" href="classbtk_1_1btk_force_platforms_extractor.html">btk.btkForcePlatformsExtractor</a>()</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;pfe.SetInput(reader.GetOutput())</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;grwf = <a class="code" href="classbtk_1_1btk_ground_reaction_wrench_filter.html">btk.btkGroundReactionWrenchFilter</a>()</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;grwf.SetInput(pfe.GetOutput())</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;grwc = grwf.GetOutput()</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;grwc.Update()</div>
</div><!-- fragment --><p>With the code above, you read a C3D file, extract force platform object, the compute the ground reaction wrench(es) (i.e. force, moment and position). The idea is to plug the output of a block to the input of another block and automatically the data are processed when you update the pipeline.</p>
<p>Another example of a powerfull pipeline is when you want to convert a set of files (e.g. Motion Analysis, BTS Bioengineering) to a C3D file.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment"># Readers</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;readerTRB = <a class="code" href="classbtk_1_1btk_acquisition_file_reader.html">btk.btkAcquisitionFileReader</a>()</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;readerTRB.SetFilename(<span class="stringliteral">&quot;myGait.trb&quot;</span>)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;readerANB = <a class="code" href="classbtk_1_1btk_acquisition_file_reader.html">btk.btkAcquisitionFileReader</a>()</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;readerANB.SetFilename(<span class="stringliteral">&quot;myGait.anb&quot;</span>)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;readerCAL = <a class="code" href="classbtk_1_1btk_acquisition_file_reader.html">btk.btkAcquisitionFileReader</a>()</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;readerCAL.SetFilename(<span class="stringliteral">&quot;forcepla.cal&quot;</span>)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;readerXLS = <a class="code" href="classbtk_1_1btk_acquisition_file_reader.html">btk.btkAcquisitionFileReader</a>()</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;readerXLS.SetFilename(<span class="stringliteral">&quot;myGait.xls&quot;</span>)</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"># Merger</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;merger = <a class="code" href="classbtk_1_1btk_merge_acquisition_filter.html">btk.btkMergeAcquisitionFilter</a>()</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;merger.SetInput(0, readerTRB.GetOutput())</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;merger.SetInput(1, readerANB.GetOutput())</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;merger.SetInput(2, readerCAL.GetOutput())</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;merger.SetInput(3, readerXLS.GetOutput())</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"># Writer</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;writer = <a class="code" href="classbtk_1_1btk_acquisition_file_writer.html">btk.btkAcquisitionFileWriter</a>()</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;writer.SetInput(merger.GetOutput())</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;writer.Update()</div>
</div><!-- fragment --><p>You can imagine to use this code in a batch to convert automatically old acquisitions.</p>
<p>All the "filters" are currently listed in the module <a class="el" href="group___b_t_k_basic_filters.html">BasicFilters</a>.</p>
<h1><a class="anchor" id="TutorialCropAcquisition"></a>
Split an acqusition into severals</h1>
<p>In case there is no adapted filters to your processing, you can easily create your onw funtion to process your data. The next exemple propose in few lines to split an acquisition into severals by given some ranges of frames. This could be usefull if you want for example to keep only some cycles. Separate analyzed task, etc. Most of the functions to modify an acquisition are in the class <a class="el" href="classbtk_1_1btk_acquisition.html" title="Contains the data related to a biomechanical acquisition. ">btk.btkAcquisition</a>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">import</span> btk</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"># The variable &#39;eventsFrame&#39; contains regions of interest (ROI) set as sets of first and last frames</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"># Note: If you use NumPy from another algorithm to create ROIs</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"># be sure that the type is &quot;int&quot; or the same type than the architecture</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"># of your OS (int32 for 32-bit OS, int64 for 64-bit OS).</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"># Otherwise an error message will be triggered mentionning that the given type</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"># in eventsFrame[i][0] or eventsFrame[i][1] is not an &quot;int&quot;.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;eventsFrame = [[170, 190], [240, 260]]</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">#Â Read the file</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;reader = <a class="code" href="classbtk_1_1btk_acquisition_file_reader.html">btk.btkAcquisitionFileReader</a>()</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;reader.SetFilename(<span class="stringliteral">&#39;myFile.c3d&#39;</span>)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;reader.Update()</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;acq = reader.GetOutput()</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;writer = <a class="code" href="classbtk_1_1btk_acquisition_file_writer.html">btk.btkAcquisitionFileWriter</a>()</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(0, len(eventsFrame)):</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="comment"># Copy original data</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  clone = acq.Clone();</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="comment"># Crop the acquisition to keep only the ROI</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  clone.ResizeFrameNumberFromEnd(acq.GetLastFrame() - eventsFrame[i][0] + 1)</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  clone.ResizeFrameNumber(eventsFrame[i][1] - eventsFrame[i][0] + 1)</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  clone.SetFirstFrame(eventsFrame[i][0])</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="comment"># Select only the events in the ROI</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  clone.ClearEvents()</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordflow">for</span> e <span class="keywordflow">in</span> <a class="code" href="namespacebtk.html#a2ccf00800966129548a08e959e36ec55">btk.Iterate</a>(acq.GetEvents()):</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">if</span> ((e.GetFrame() &gt; clone.GetFirstFrame()) <span class="keywordflow">and</span> (e.GetFrame() &lt; clone.GetLastFrame())):</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      clone.AppendEvent(e)</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="comment"># Create new C3D file</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  writer.SetInput(clone)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  writer.SetFilename(<span class="stringliteral">&#39;croppedRegion&#39;</span> + str(i+1) + <span class="stringliteral">&#39;.c3d&#39;</span>)</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  writer.Update()</div>
</div><!-- fragment --><h1><a class="anchor" id="TutorialWrappingPython"></a>
Technology behind BTK for Python</h1>
<p>To write the Python package, it was decided to wrap the C++ code instead of writing from scratch all the code. This gives mainly the advantage to maintain only one code and to have the same functions in the C++ and the wrapping(s).</p>
<p>To do that, the software <a href="http://www.swig.org/">SWIG</a> was used as well as the Python package <a href="http://www.numpy.org/">NumPy</a>. The former is used to create the code to wrap C++ object to Python object, while the latter is used to convert native C++ matrices to native Python matrices. If this design gives lots of benefits (e.g. one SWIG file to define wrapped C++ classes/methods), it has the main drawback to not be able to interact directly with some internal objects like the matrices. For example, trying to access to the coordiantes of a marker and modify one value for a specific frame is not possible. Instead of that, several methods are proposed in the Python wrapping.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;pt = acq.GetPoint(0)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"># The following line doesn&#39;t work as the NumPy array is created when the method GetValues() is called</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;pt.GetValues()[0,0] = 1.5</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"># Special method to set the value.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;pt.SetValue(0, 0, 1.5)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"># Other possibiility but create a temporary NumPy array.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"># This method should be used if you set lots of values or direclty set a NumPy array created elsewhere.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;val = pt.GetValues();</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;val[0,0] = 1.5</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;pt.SetValues(val);</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 27 2013 23:58:43 for BTK Python wrapper by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
